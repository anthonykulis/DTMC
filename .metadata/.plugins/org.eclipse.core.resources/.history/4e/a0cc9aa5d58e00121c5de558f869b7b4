/*
 * pid_test.c
 *
 *  Created on: Mar 17, 2013
 *      Author: kulis
 */

#include <stdio.h>
#include <stdlib.h>
#include <sys/time.h>
#include <time.h>
#include <unistd.h>

#include "pid.h"

int main(int argc, char** argv){

	PID* pids;
	pids = init(1);

	PID pid = *pids;

	pid.feed_direction = FORWARD;
	pid.goal = 5.0;
	pid.interval = 10;
	pid.kd = 1;
	pid.ki = 5;
	pid.kp = 1;
	pid.max = 255;
	pid.min = -255;
	pid.is_paused = 0;


	srandom(time(NULL));
	struct timeval now;

	gettimeofday(&now, NULL);
	unsigned long start = now.tv_usec / 1000;
	unsigned long end = start + 10000;
	pid.goal = ((end - start) / 2) + start;

	while(start < end){

		pid.input = start;
		run(&pid);
		fprintf(stdout, "Tick start: %li -- Input: %.02f -- Output: %.02f\n", start, pid.input, pid.output);

		usleep(10* 1000);
		start += 10;

		if(pid.output == -255) break;
	}

	start = end;
	end = start + 10000;

	while(pid.output != 0.0){

		pid.input = pid.goal;
		run(&pid);
		fprintf(stdout, "Tick start: %li -- Input: %.02f -- Output: %.02f\n", start, pid.input, pid.output);

		usleep(100* 1000);

	}
	return EXIT_SUCCESS;
}
